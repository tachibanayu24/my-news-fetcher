name: Fetch Daily News

on:
  schedule:
    - cron: "0 23 * * *" # JST 08:00
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œ

jobs:
  fetch-news:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - name: Run Claude Code
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: |
            --model claude-opus-4-5-20251101
            --allowedTools "WebSearch,Read,Bash(gh issue view:*),Bash(gh issue create:*),Bash(gh issue list:*),Bash(date:*)"
          prompt: |
            ä»Šæ—¥ã®æ—¥ä»˜: $(date +%Y-%m-%d)

            ## ã‚¿ã‚¹ã‚¯
            å„ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ¤œç´¢ã—ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã”ã¨ã«å€‹åˆ¥ã®Issueã‚’ä½œæˆã™ã‚‹ã€‚

            ## æ‰‹é †

            1. Issue #1 (TARGET_TOPICS) ã‚’å–å¾—:
               gh issue view 1 --json body

            2. likes.md ã¨ dislikes.md ã‚’èª­ã‚“ã§å¥½ã¿ã‚’æŠŠæ¡

            3. æ—¢å­˜ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹Issueã‚’ç¢ºèªï¼ˆé‡è¤‡é˜²æ­¢ï¼‰:
               gh issue list --search "ğŸ“° in:title" --json title,body --limit 50

            4. å„ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦Webæ¤œç´¢ã§æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—
               - å¿…ãšã€Œä»Šæ—¥ã®æ—¥ä»˜ã€ã‚’æ¤œç´¢ã‚¯ã‚¨ãƒªã«å«ã‚ã‚‹ï¼ˆä¾‹: "LLM 2026å¹´1æœˆ13æ—¥"ï¼‰
               - 24æ™‚é–“ä»¥å†…ã«å…¬é–‹ã•ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ã¿ã‚’å¯¾è±¡
               - likes.md ã®å‚¾å‘ã«åˆã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å„ªå…ˆ
               - dislikes.md ã®å‚¾å‘ã«åˆã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯é™¤å¤–
               - æ—¢å­˜Issueã¨åŒã˜URLã¾ãŸã¯åŒã˜å†…å®¹ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ã‚¹ã‚­ãƒƒãƒ—
               - å„ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ãæœ€å¤§3ä»¶

            5. è¦‹ã¤ã‹ã£ãŸãƒ‹ãƒ¥ãƒ¼ã‚¹ãã‚Œãã‚Œã«å¯¾ã—ã¦Issueã‚’ä½œæˆï¼ˆ1ãƒ‹ãƒ¥ãƒ¼ã‚¹ = 1 Issueï¼‰:
               gh issue create --title "ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹å†…å®¹ã®è¦ç´„ï¼ˆ30æ–‡å­—ä»¥å†…ï¼‰" --body "æœ¬æ–‡"

               ã€æœ¬æ–‡ã®Markdownãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå¿…ãšã“ã®å½¢å¼ã§ï¼‰ã€‘
               ```
               ## ã‚µãƒãƒªãƒ¼
               150æ–‡å­—ä»¥å†…ã®è¦ç´„ã‚’ã“ã“ã«æ›¸ã

               ## URL
               https://example.com/news/xxx

               ## ãƒã‚¤ãƒ³ãƒˆ
               - ãƒã‚¤ãƒ³ãƒˆ1
               - ãƒã‚¤ãƒ³ãƒˆ2
               - ãƒã‚¤ãƒ³ãƒˆ3
               ```

            ## é‡è¦
            - å¿…ãšè¤‡æ•°ã®Issueã‚’ä½œæˆã™ã‚‹ã“ã¨ï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã£ãŸæ•°ã ã‘ï¼‰
            - 1ã¤ã®Issueã«è¤‡æ•°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ã¾ã¨ã‚ãªã„ã“ã¨
