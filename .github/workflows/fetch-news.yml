name: Fetch Daily News

on:
  schedule:
    - cron: "0 23 * * *" # JST 08:00
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œ

jobs:
  fetch-news:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - name: Run Claude Code
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: |
            --model claude-opus-4-5-20251101
            --allowedTools "WebSearch,Read,Bash(gh issue view:*),Bash(gh issue create:*)"
          prompt: |
            1. Issue #1 (TARGET_TOPICS) ã‚’å–å¾—:
               gh issue view 1 --json body

            2. feedback/likes.md ã¨ feedback/dislikes.md ã‚’èª­ã‚“ã§å¥½ã¿ã‚’æŠŠæ¡

            3. å„ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ä»Šæ—¥ã®æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’Webæ¤œç´¢ã§å–å¾—
               - likes.md ã®å‚¾å‘ã«åˆã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å„ªå…ˆ
               - dislikes.md ã®å‚¾å‘ã«åˆã†ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯é™¤å¤–

            4. ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§Issueã‚’ä½œæˆ:
               ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹å†…å®¹ã®è¦ç´„ï¼ˆ30æ–‡å­—ä»¥å†…ï¼‰
               ã€æœ¬æ–‡ã€‘
               - ã‚µãƒãƒªãƒ¼: 150æ–‡å­—ä»¥å†…
               - URL: å…ƒè¨˜äº‹ã¸ã®ãƒªãƒ³ã‚¯
               - ãƒã‚¤ãƒ³ãƒˆ: ç®‡æ¡æ›¸ã3ã¤

            5. Issueä½œæˆ:
               gh issue create --title "ğŸ“° è¦ç´„" --body "..."
