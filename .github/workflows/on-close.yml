name: Record Feedback

on:
  issues:
    types: [closed]

jobs:
  record-feedback:
    if: startsWith(github.event.issue.title, 'ğŸ“°')
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: read
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Run Claude Code
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: |
            --model claude-opus-4-5-20251101
            --allowedTools "Read,Write,Bash(git add:*),Bash(git commit:*),Bash(git push:*),Bash(gh api:*)"
          prompt: |
            closeã•ã‚ŒãŸIssueã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¨˜éŒ²:

            1. Issueã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—:
               gh api repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/reactions

            2. ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦å‡¦ç†:
               - ğŸ‘ (+1) ãŒã‚ã‚Œã° feedback/likes.md ã«è¿½è¨˜
               - ğŸ‘ (-1) ãŒã‚ã‚Œã° feedback/dislikes.md ã«è¿½è¨˜
               - ã©ã¡ã‚‰ã‚‚ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„

            3. è¿½è¨˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
               - Issueã‚¿ã‚¤ãƒˆãƒ« | URLï¼ˆæœ¬æ–‡ã‹ã‚‰æŠ½å‡ºï¼‰

            4. å¤‰æ›´ãŒã‚ã‚Œã°ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥:
               git add feedback/
               git commit -m "Record feedback for #${{ github.event.issue.number }}"
               git push
